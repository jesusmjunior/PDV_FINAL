<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORION PDV - Relatórios</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono&display=swap">
    <link rel="stylesheet" href="assets/css/orion-theme.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="icon" href="assets/img/favicon.ico" type="image/x-icon">
</head>
<body>
    <!-- Container Principal -->
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="assets/img/logo-small.png" alt="ORION PDV">
                    <span>ORION PDV</span>
                </div>
                <button id="sidebar-collapse" class="sidebar-toggle d-none d-md-block">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="sidebar-menu">
                <a href="dashboard.html" class="menu-item">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="venda.html" class="menu-item">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Vendas PDV</span>
                </a>
                <a href="produto.html" class="menu-item">
                    <i class="fas fa-box"></i>
                    <span>Produtos</span>
                </a>
                <a href="estoque.html" class="menu-item">
                    <i class="fas fa-warehouse"></i>
                    <span>Estoque</span>
                </a>
                <a href="cliente.html" class="menu-item">
                    <i class="fas fa-users"></i>
                    <span>Clientes</span>
                </a>
                <a href="relatorio.html" class="menu-item active">
                    <i class="fas fa-chart-bar"></i>
                    <span>Relatórios</span>
                </a>
                <a href="config.html" class="menu-item">
                    <i class="fas fa-cog"></i>
                    <span>Configurações</span>
                </a>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-menu" id="user-menu">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-info">
                        <div class="user-name" id="user-name">Carregando...</div>
                        <div class="user-role" id="user-role">Carregando...</div>
                    </div>
                </div>
                <button id="btn-logout" class="sidebar-toggle">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
        
        <!-- Conteúdo Principal -->
        <div class="main-content">
            <div class="topbar">
                <div class="topbar-title">
                    <h1>Relatórios</h1>
                </div>
                <div class="topbar-actions">
                    <div id="current-date" class="d-none d-md-block">Carregando data...</div>
                </div>
            </div>
            
            <div class="page-content">
                <!-- Tabs -->
                <div class="tabs">
                    <div id="tab-vendas" class="tab active">Vendas</div>
                    <div id="tab-produtos" class="tab">Produtos</div>
                    <div id="tab-clientes" class="tab">Clientes</div>
                </div>
                
                <!-- Conteúdo da aba Vendas -->
                <div id="content-vendas" class="tab-content active">
                    <!-- Filtros -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <div class="card-title">Filtros</div>
                        </div>
                        <div class="card-body">
                            <div class="row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div class="form-group">
                                    <label for="data-inicio" class="form-label">Data Inicial</label>
                                    <input type="date" id="data-inicio" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="data-fim" class="form-label">Data Final</label>
                                    <input type="date" id="data-fim" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="cliente" class="form-label">Cliente</label>
                                    <select id="cliente" class="form-control">
                                        <option value="">Todos</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="forma-pagamento" class="form-label">Forma de Pagamento</label><div class="form-group">
                                    <label for="forma-pagamento" class="form-label">Forma de Pagamento</label>
                                    <select id="forma-pagamento" class="form-control">
                                        <option value="">Todas</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-between mt-3">
                                <button id="btn-limpar-filtros" class="btn btn-outline-primary">
                                    <i class="fas fa-eraser"></i> Limpar Filtros
                                </button>
                                <button id="btn-gerar-relatorio" class="btn btn-primary">
                                    <i class="fas fa-chart-bar"></i> Gerar Relatório
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Resumo -->
                    <div class="dashboard-stats mb-4">
                        <div class="stat-card">
                            <div class="stat-icon sales">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-value" id="total-vendas">0</div>
                                <div class="stat-label">Vendas</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon revenue">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-value" id="total-faturamento">R$ 0,00</div>
                                <div class="stat-label">Faturamento</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon products">
                                <i class="fas fa-tags"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-value" id="ticket-medio">R$ 0,00</div>
                                <div class="stat-label">Ticket Médio</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon customers">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-value" id="total-descontos">R$ 0,00</div>
                                <div class="stat-label">Descontos</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gráficos -->
                    <div class="row" style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Vendas por Período</div>
                            </div>
                            <div class="card-body">
                                <canvas id="chart-vendas" width="400" height="200"></canvas>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Vendas por Forma de Pagamento</div>
                            </div>
                            <div class="card-body">
                                <canvas id="chart-pagamentos" width="200" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabela de Vendas -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Detalhamento de Vendas</div>
                            <div>
                                <button id="btn-exportar-vendas" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-file-export"></i> Exportar
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table" id="tabela-vendas">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Data</th>
                                            <th>Cliente</th>
                                            <th>Itens</th>
                                            <th>Forma de Pagamento</th>
                                            <th>Subtotal</th>
                                            <th>Desconto</th>
                                            <th>Total</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="9" class="text-center text-muted py-3">
                                                <p>Utilize os filtros acima para gerar o relatório</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Conteúdo da aba Produtos -->
                <div id="content-produtos" class="tab-content">
                    <!-- Filtros -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <div class="card-title">Filtros</div>
                        </div>
                        <div class="card-body">
                            <div class="row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div class="form-group">
                                    <label for="data-inicio-produtos" class="form-label">Data Inicial</label>
                                    <input type="date" id="data-inicio-produtos" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="data-fim-produtos" class="form-label">Data Final</label>
                                    <input type="date" id="data-fim-produtos" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="grupo-produto" class="form-label">Grupo</label>
                                    <select id="grupo-produto" class="form-control">
                                        <option value="">Todos</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="ordenacao-produto" class="form-label">Ordenar por</label>
                                    <select id="ordenacao-produto" class="form-control">
                                        <option value="quantidade">Quantidade Vendida</option>
                                        <option value="faturamento">Faturamento</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-between mt-3">
                                <button id="btn-limpar-filtros-produtos" class="btn btn-outline-primary">
                                    <i class="fas fa-eraser"></i> Limpar Filtros
                                </button>
                                <button id="btn-gerar-relatorio-produtos" class="btn btn-primary">
                                    <i class="fas fa-chart-bar"></i> Gerar Relatório
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gráficos -->
                    <div class="row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Top 10 Produtos - Quantidade</div>
                            </div>
                            <div class="card-body">
                                <canvas id="chart-produtos-quantidade" width="300" height="300"></canvas>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Top 10 Produtos - Faturamento</div>
                            </div>
                            <div class="card-body">
                                <canvas id="chart-produtos-faturamento" width="300" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabela de Produtos -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Detalhamento de Produtos</div>
                            <div>
                                <button id="btn-exportar-produtos" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-file-export"></i> Exportar
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table" id="tabela-produtos">
                                    <thead>
                                        <tr>
                                            <th>Código</th>
                                            <th>Produto</th>
                                            <th>Grupo</th>
                                            <th>Preço</th>
                                            <th>Quantidade Vendida</th>
                                            <th>Faturamento</th>
                                            <th>% do Faturamento</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="7" class="text-center text-muted py-3">
                                                <p>Utilize os filtros acima para gerar o relatório</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Conteúdo da aba Clientes -->
                <div id="content-clientes" class="tab-content">
                    <!-- Filtros -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <div class="card-title">Filtros</div>
                        </div>
                        <div class="card-body">
                            <div class="row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div class="form-group">
                                    <label for="data-inicio-clientes" class="form-label">Data Inicial</label>
                                    <input type="date" id="data-inicio-clientes" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="data-fim-clientes" class="form-label">Data Final</label>
                                    <input type="date" id="data-fim-clientes" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="cidade-cliente" class="form-label">Cidade</label>
                                    <select id="cidade-cliente" class="form-control">
                                        <option value="">Todas</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="ordenacao-cliente" class="form-label">Ordenar por</label>
                                    <select id="ordenacao-cliente" class="form-control">
                                        <option value="frequencia">Frequência de Compras</option>
                                        <option value="faturamento">Faturamento</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-between mt-3">
                                <button id="btn-limpar-filtros-clientes" class="btn btn-outline-primary">
                                    <i class="fas fa-eraser"></i> Limpar Filtros
                                </button>
                                <button id="btn-gerar-relatorio-clientes" class="btn btn-primary">
                                    <i class="fas fa-chart-bar"></i> Gerar Relatório
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gráficos -->
                    <div class="row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Top 10 Clientes - Frequência</div>
                            </div>
                            <div class="card-body">
                                <canvas id="chart-clientes-frequencia" width="300" height="300"></canvas>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Top 10 Clientes - Faturamento</div>
                            </div>
                            <div class="card-body">
                                <canvas id="chart-clientes-faturamento" width="300" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabela de Clientes -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Detalhamento de Clientes</div>
                            <div>
                                <button id="btn-exportar-clientes" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-file-export"></i> Exportar
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table" id="tabela-clientes">
                                    <thead>
                                        <tr>
                                            <th>Cliente</th>
                                            <th>Documento</th>
                                            <th>Cidade</th>
                                            <th>Compras</th>
                                            <th>Última Compra</th>
                                            <th>Faturamento</th>
                                            <th>Ticket Médio</th>
                                            <th>% do Faturamento</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="8" class="text-center text-muted py-3">
                                                <p>Utilize os filtros acima para gerar o relatório</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notificações -->
    <div class="toast-container" id="toast-container"></div>
    
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="assets/js/database.js"></script>
    <script src="assets/js/db-fix.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/core.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar autenticação
            if (!auth.verificarAutenticacao()) {
                window.location.href = 'index.html';
                return;
            }
            
            // Dados do usuário
            const user = auth.getUsuarioAtual();
            document.getElementById('user-name').textContent = user.nome;
            document.getElementById('user-role').textContent = user.perfil === 'admin' ? 'Administrador' : user.perfil === 'supervisor' ? 'Supervisor' : 'Vendedor';
            
            // Data atual
            const dataAtual = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = dataAtual.toLocaleDateString('pt-BR', options);
            
            // Elementos DOM - Tabs
            const tabVendas = document.getElementById('tab-vendas');
            const tabProdutos = document.getElementById('tab-produtos');
            const tabClientes = document.getElementById('tab-clientes');
            
            const contentVendas = document.getElementById('content-vendas');
            const contentProdutos = document.getElementById('content-produtos');
            const contentClientes = document.getElementById('content-clientes');
            
            // Elementos DOM - Filtros Vendas
            const dataInicioInput = document.getElementById('data-inicio');
            const dataFimInput = document.getElementById('data-fim');
            const clienteSelect = document.getElementById('cliente');
            const formaPagamentoSelect = document.getElementById('forma-pagamento');
            const btnLimparFiltros = document.getElementById('btn-limpar-filtros');
            const btnGerarRelatorio = document.getElementById('btn-gerar-relatorio');
            
            // Elementos DOM - Filtros Produtos
            const dataInicioProdutosInput = document.getElementById('data-inicio-produtos');
            const dataFimProdutosInput = document.getElementById('data-fim-produtos');
            const grupoProdutoSelect = document.getElementById('grupo-produto');
            const ordenacaoProdutoSelect = document.getElementById('ordenacao-produto');
            const btnLimparFiltrosProdutos = document.getElementById('btn-limpar-filtros-produtos');
            const btnGerarRelatorioProdutos = document.getElementById('btn-gerar-relatorio-produtos');
            
            // Elementos DOM - Filtros Clientes
            const dataInicioClientesInput = document.getElementById('data-inicio-clientes');
            const dataFimClientesInput = document.getElementById('data-fim-clientes');
            const cidadeClienteSelect = document.getElementById('cidade-cliente');
            const ordenacaoClienteSelect = document.getElementById('ordenacao-cliente');
            const btnLimparFiltrosClientes = document.getElementById('btn-limpar-filtros-clientes');
            const btnGerarRelatorioClientes = document.getElementById('btn-gerar-relatorio-clientes');
            
            // Elementos DOM - Exportação
            const btnExportarVendas = document.getElementById('btn-exportar-vendas');
            const btnExportarProdutos = document.getElementById('btn-exportar-produtos');
            const btnExportarClientes = document.getElementById('btn-exportar-clientes');
            
            // Tabelas
            const tabelaVendas = document.getElementById('tabela-vendas');
            const tabelaProdutos = document.getElementById('tabela-produtos');
            const tabelaClientes = document.getElementById('tabela-clientes');
            
            // Gráficos
            let chartVendas = null;
            let chartPagamentos = null;
            let chartProdutosQuantidade = null;
            let chartProdutosFaturamento = null;
            let chartClientesFrequencia = null;
            let chartClientesFaturamento = null;
            
            // Dados dos relatórios
            let relatorioVendas = null;
            let relatorioProdutos = null;
            let relatorioClientes = null;
            
            // Inicialização
            inicializarDatas();
            carregarClientes();
            carregarFormasPagamento();
            carregarGruposProdutos();
            carregarCidadesClientes();
            
            // Event Listeners - Tabs
            tabVendas.addEventListener('click', function() {
                ativarAba('vendas');
            });
            
            tabProdutos.addEventListener('click', function() {
                ativarAba('produtos');
            });
            
            tabClientes.addEventListener('click', function() {
                ativarAba('clientes');
            });
            
            // Event Listeners - Relatórios
            btnGerarRelatorio.addEventListener('click', gerarRelatorioVendas);
            btnGerarRelatorioProdutos.addEventListener('click', gerarRelatorioProdutos);
            btnGerarRelatorioClientes.addEventListener('click', gerarRelatorioClientes);
            
            // Event Listeners - Limpar Filtros
            btnLimparFiltros.addEventListener('click', function() {
                inicializarDatas();
                clienteSelect.value = '';
                formaPagamentoSelect.value = '';
            });
            
            btnLimparFiltrosProdutos.addEventListener('click', function() {
                inicializarDatasProdutos();
                grupoProdutoSelect.value = '';
                ordenacaoProdutoSelect.value = 'quantidade';
            });
            
            btnLimparFiltrosClientes.addEventListener('click', function() {
                inicializarDatasClientes();
                cidadeClienteSelect.value = '';
                ordenacaoClienteSelect.value = 'frequencia';
            });
            
            // Event Listeners - Exportação
            btnExportarVendas.addEventListener('click', exportarVendas);
            btnExportarProdutos.addEventListener('click', exportarProdutos);
            btnExportarClientes.addEventListener('click', exportarClientes);
            
            // Logout
            document.getElementById('btn-logout').addEventListener('click', function() {
                auth.fazerLogout();
                window.location.href = 'index.html';
            });
            
            // ========== FUNÇÕES ==========<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORION PDV - Relatórios</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono&display=swap">
    <link rel="stylesheet" href="assets/css/orion-theme.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="icon" href="assets/img/favicon.ico" type="image/x-icon">
</head>
<body>
    <!-- Container Principal -->
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="assets/img/logo-small.png" alt="ORION PDV">
                    <span>ORION PDV</span>
                </div>
                <button id="sidebar-collapse" class="sidebar-toggle d-none d-md-block">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="sidebar-menu">
                <a href="dashboard.html" class="menu-item">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="venda.html" class="menu-item">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Vendas PDV</span>
                </a>
                <a href="produto.html" class="menu-item">
                    <i class="fas fa-box"></i>
                    <span>Produtos</span>
                </a>
                <a href="estoque.html" class="menu-item">
                    <i class="fas fa-warehouse"></i>
                    <span>Estoque</span>
                </a>
                <a href="cliente.html" class="menu-item">
                    <i class="fas fa-users"></i>
                    <span>Clientes</span>
                </a>
                <a href="relatorio.html" class="menu-item active">
                    <i class="fas fa-chart-bar"></i>
                    <span>Relatórios</span>
                </a>
                <a href="config.html" class="menu-item">
                    <i class="fas fa-cog"></i>
                    <span>Configurações</span>
                </a>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-menu" id="user-menu">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-info">
                        <div class="user-name" id="user-name">Carregando...</div>
                        <div class="user-role" id="user-role">Carregando...</div>
                    </div>
                </div>
                <button id="btn-logout" class="sidebar-toggle">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
        
        <!-- Conteúdo Principal -->
        <div class="main-content">
            <div class="topbar">
                <div class="topbar-title">
                    <h1>Relatórios</h1>
                </div>
                <div class="topbar-actions">
                    <div id="current-date" class="d-none d-md-block">Carregando data...</div>
                </div>
            </div>
            
            <div class="page-content">
                <!-- Tabs -->
                <div class="tabs">
                    <div id="tab-vendas" class="tab active">Vendas</div>
                    <div id="tab-produtos" class="tab">Produtos</div>
                    <div id="tab-clientes" class="tab">Clientes</div>
                </div>
                
                <!-- Conteúdo da aba Vendas -->
                <div id="content-vendas" class="tab-content active">
                    <!-- Filtros -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <div class="card-title">Filtros</div>
                        </div>
                        <div class="card-body">
                            <div class="row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div class="form-group">
                                    <label for="data-inicio" class="form-label">Data Inicial</label>
                                    <input type="date" id="data-inicio" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="data-fim" class="form-label">Data Final</label>
                                    <input type="date" id="data-fim" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="cliente" class="form-label">Cliente</label>
                                    <select id="cliente" class="form-control">
                                        <option value="">Todos</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="forma-pagamento" class="form-label">Forma de Pagamento</label>
        // ========== FUNÇÕES ==========
            
            function ativarAba(aba) {
                // Desativar todas as abas
                tabVendas.classList.remove('active');
                tabProdutos.classList.remove('active');
                tabClientes.classList.remove('active');
                
                // Ocultar todos os conteúdos
                contentVendas.classList.remove('active');
                contentProdutos.classList.remove('active');
                contentClientes.classList.remove('active');
                
                // Ativar aba selecionada
                if (aba === 'vendas') {
                    tabVendas.classList.add('active');
                    contentVendas.classList.add('active');
                } else if (aba === 'produtos') {
                    tabProdutos.classList.add('active');
                    contentProdutos.classList.add('active');
                } else if (aba === 'clientes') {
                    tabClientes.classList.add('active');
                    contentClientes.classList.add('active');
                }
            }
            
            function inicializarDatas() {
                // Definir data de hoje como padrão para data fim
                const hoje = new Date();
                const dataFimStr = hoje.toISOString().split('T')[0];
                dataFimInput.value = dataFimStr;
                
                // Definir data de 30 dias atrás como padrão para data início
                const dataInicio = new Date();
                dataInicio.setDate(dataInicio.getDate() - 30);
                const dataInicioStr = dataInicio.toISOString().split('T')[0];
                dataInicioInput.value = dataInicioStr;
                
                // Aplicar as mesmas datas para as outras abas
                inicializarDatasProdutos();
                inicializarDatasClientes();
            }
            
            function inicializarDatasProdutos() {
                dataInicioProdutosInput.value = dataInicioInput.value;
                dataFimProdutosInput.value = dataFimInput.value;
            }
            
            function inicializarDatasClientes() {
                dataInicioClientesInput.value = dataInicioInput.value;
                dataFimClientesInput.value = dataFimInput.value;
            }
            
            function carregarClientes() {
                // Obter clientes
                const clientes = db.getClientes();
                
                // Limpar select
                clienteSelect.innerHTML = '<option value="">Todos</option>';
                
                // Ordenar por nome
                clientes.sort((a, b) => a.nome.localeCompare(b.nome));
                
                // Adicionar opções
                clientes.forEach(cliente => {
                    // Não adicionar o "Consumidor Final" como opção (geralmente é o cliente padrão)
                    if (cliente.id === "1" && cliente.nome === "Consumidor Final") {
                        return;
                    }
                    
                    const option = document.createElement('option');
                    option.value = cliente.id;
                    option.textContent = cliente.nome;
                    clienteSelect.appendChild(option);
                });
            }
            
            function carregarFormasPagamento() {
                // Formas de pagamento disponíveis
                const formasPagamento = [
                    { valor: 'dinheiro', nome: 'Dinheiro' },
                    { valor: 'cartao_credito', nome: 'Cartão de Crédito' },
                    { valor: 'cartao_debito', nome: 'Cartão de Débito' },
                    { valor: 'pix', nome: 'PIX' },
                    { valor: 'boleto', nome: 'Boleto Bancário' },
                    { valor: 'transferencia', nome: 'Transferência Bancária' }
                ];
                
                // Limpar select
                formaPagamentoSelect.innerHTML = '<option value="">Todas</option>';
                
                // Adicionar opções
                formasPagamento.forEach(forma => {
                    const option = document.createElement('option');
                    option.value = forma.valor;
                    option.textContent = forma.nome;
                    formaPagamentoSelect.appendChild(option);
                });
            }
            
            function carregarGruposProdutos() {
                // Obter grupos de produtos
                let grupos = [];
                
                // Verificar se há método específico no db
                if (typeof db.getGruposProdutos === 'function') {
                    grupos = db.getGruposProdutos();
                } else {
                    // Extrair grupos dos produtos
                    const produtos = db.getProdutos();
                    const gruposSet = new Set();
                    
                    Object.values(produtos).forEach(produto => {
                        if (produto.grupo) {
                            gruposSet.add(produto.grupo);
                        }
                    });
                    
                    grupos = [...gruposSet].sort();
                }
                
                // Limpar select
                grupoProdutoSelect.innerHTML = '<option value="">Todos</option>';
                
                // Adicionar opções
                grupos.forEach(grupo => {
                    const option = document.createElement('option');
                    option.value = grupo;
                    option.textContent = grupo;
                    grupoProdutoSelect.appendChild(option);
                });
            }
            
            function carregarCidadesClientes() {
                // Obter clientes
                const clientes = db.getClientes();
                
                // Extrair cidades únicas
                const cidadesSet = new Set();
                
                clientes.forEach(cliente => {
                    if (cliente.cidade) {
                        cidadesSet.add(cliente.cidade);
                    }
                });
                
                // Converter para array e ordenar
                const cidades = [...cidadesSet].sort();
                
                // Limpar select
                cidadeClienteSelect.innerHTML = '<option value="">Todas</option>';
                
                // Adicionar opções
                cidades.forEach(cidade => {
                    const option = document.createElement('option');
                    option.value = cidade;
                    option.textContent = cidade;
                    cidadeClienteSelect.appendChild(option);
                });
            }
            
            function gerarRelatorioVendas() {
                // Verificar se o db tem a função de gerar relatório
                if (typeof db.gerarRelatorioVendas !== 'function') {
                    exibirMensagem('Função de relatório não disponível nesta versão do sistema.', 'error');
                    return;
                }
                
                // Obter filtros
                const filtros = {
                    dataInicio: dataInicioInput.value,
                    dataFim: dataFimInput.value,
                    clienteId: clienteSelect.value,
                    formaPagamento: formaPagamentoSelect.value
                };
                
                // Gerar relatório
                relatorioVendas = db.gerarRelatorioVendas(filtros);
                
                // Atualizar totais
                document.getElementById('total-vendas').textContent = relatorioVendas.totais.vendas;
                document.getElementById('total-faturamento').textContent = 'R$ ' + relatorioVendas.totais.valor.toFixed(2);
                document.getElementById('total-descontos').textContent = 'R$ ' + relatorioVendas.totais.desconto.toFixed(2);
                
                // Calcular ticket médio
                const ticketMedio = relatorioVendas.totais.vendas > 0 ? 
                    relatorioVendas.totais.valor / relatorioVendas.totais.vendas : 0;
                document.getElementById('ticket-medio').textContent = 'R$ ' + ticketMedio.toFixed(2);
                
                // Atualizar gráficos
                atualizarGraficoVendas();
                atualizarGraficoPagamentos();
                
                // Atualizar tabela
                atualizarTabelaVendas();
                
                // Exibir mensagem
                exibirMensagem('Relatório de vendas gerado com sucesso!', 'success');
            }
            
            function atualizarGraficoVendas() {
                // Preparar dados para o gráfico de vendas por período
                const labels = [];
                const dados = [];
                
                // Ordenar datas
                const datas = Object.keys(relatorioVendas.vendasPorData).sort();
                
                datas.forEach(data => {
                    // Formatar data
                    const dataObj = new Date(data);
                    const dataFormatada = dataObj.toLocaleDateString('pt-BR');
                    
                    labels.push(dataFormatada);
                    dados.push(relatorioVendas.vendasPorData[data]);
                });
                
                // Criar ou atualizar gráfico
                const ctx = document.getElementById('chart-vendas').getContext('2d');
                
                if (chartVendas) {
                    chartVendas.data.labels = labels;
                    chartVendas.data.datasets[0].data = dados;
                    chartVendas.update();
                } else {
                    chartVendas = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Faturamento (R$)',
                                data: dados,
                                backgroundColor: 'rgba(11, 61, 145, 0.6)',
                                borderColor: 'rgba(11, 61, 145, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return 'R$ ' + value.toFixed(2);
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }
            
            function atualizarGraficoPagamentos() {
                // Preparar dados para o gráfico de vendas por forma de pagamento
                const labels = [];
                const dados = [];
                const cores = [
                    'rgba(11, 61, 145, 0.6)',
                    'rgba(255, 125, 0, 0.6)',
                    'rgba(67, 160, 71, 0.6)',
                    'rgba(255, 179, 0, 0.6)',
                    'rgba(229, 57, 53, 0.6)',
                    'rgba(3, 155, 229, 0.6)'
                ];
                
                // Obter formas de pagamento
                const formasPagamento = Object.keys(relatorioVendas.formasPagamento);
                
                formasPagamento.forEach((forma, index) => {
                    labels.push(forma);
                    dados.push(relatorioVendas.formasPagamento[forma].valor);
                });
                
                // Criar ou atualizar gráfico
                const ctx = document.getElementById('chart-pagamentos').getContext('2d');
                
                if (chartPagamentos) {
                    chartPagamentos.data.labels = labels;
                    chartPagamentos.data.datasets[0].data = dados;
                    chartPagamentos.update();
                } else {
                    chartPagamentos = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: labels,
                            datasets: [{
                                data: dados,
                                backgroundColor: cores,
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const valor = context.raw;
                                            const percentual = ((valor / relatorioVendas.totais.valor) * 100).toFixed(2);
                                            return `R$ ${valor.toFixed(2)} (${percentual}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }
            
            function atualizarTabelaVendas() {
                // Obter vendas do relatório
                const vendas = relatorioVendas.vendas;
                
                // Limpar tabela
                const tbody = tabelaVendas.querySelector('tbody');
                
                if (vendas.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="9" class="text-center text-muted py-3">
                                <i class="fas fa-info-circle fa-2x mb-3"></i>
                                <p>Nenhuma venda encontrada para os filtros selecionados</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                // Gerar linhas da tabela
                let html = '';
                
                vendas.forEach(venda => {
                    // Formatar data
                    const data = new Date(venda.data);
                    const dataFormatada = data.toLocaleDateString('pt-BR') + ' ' + 
                        data.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                    
                    html += `
                        <tr>
                            <td>${venda.id}</td>
                            <td>${dataFormatada}</td>
                            <td>${venda.cliente_nome}</td>
                            <td>${venda.itens.length}</td>
                            <td>${venda.forma_pagamento}</td>
                            <td>R$ ${venda.subtotal.toFixed(2)}</td>
                            <td>R$ ${venda.desconto.toFixed(2)}</td>
                            <td>R$ ${venda.total.toFixed(2)}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-info btn-ver-venda" data-id="${venda.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
                
                // Adicionar eventos aos botões
                document.querySelectorAll('.btn-ver-venda').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        window.open(`recibo.html?venda=${id}`, '_blank');
                    });
                });
            }
            
            function gerarRelatorioProdutos() {
                // Obter filtros
                const filtros = {
                    dataInicio: dataInicioProdutosInput.value,
                    dataFim: dataFimProdutosInput.value,
                    grupo: grupoProdutoSelect.value,
                    ordenacao: ordenacaoProdutoSelect.value
                };
                
                // Obter vendas filtradas por data
                const vendas = db.getVendas().filter(venda => {
                    const dataVenda = new Date(venda.data);
                    const dataInicio = new Date(filtros.dataInicio);
                    const dataFim = new Date(filtros.dataFim);
                    
                    dataInicio.setHours(0, 0, 0, 0);
                    dataFim.setHours(23, 59, 59, 999);
                    
                    return dataVenda >= dataInicio && dataVenda <= dataFim;
                });
                
                // Obter produtos
                const produtos = db.getProdutos();
                
                // Mapear produtos vendidos e suas quantidades/faturamento
                const produtosVendidos = {};
                
                vendas.forEach(venda => {
                    venda.itens.forEach(item => {
                        if (!produtosVendidos[item.produto_id]) {
                            // Obter dados do produto
                            const produto = produtos[item.produto_id];
                            
                            // Se não encontrar o produto ou não corresponder ao filtro de grupo, ignorar
                            if (!produto || (filtros.grupo && produto.grupo !== filtros.grupo)) {
                                return;
                            }
                            
                            produtosVendidos[item.produto_id] = {
                                id: item.produto_id,
                                codigo: produto.codigo_barras || '',
                                nome: item.nome,
                                preco: item.preco,
                                grupo: produto.grupo || '',
                                quantidade: 0,
                                faturamento: 0
                            };
                        }
                        
                        produtosVendidos[item.produto_id].quantidade += item.quantidade;
                        produtosVendidos[item.produto_id].faturamento += item.subtotal;
                    });
                });
                
                // Converter para array
                const produtosArray = Object.values(produtosVendidos);
                
                // Ordenar conforme selecionado
                if (filtros.ordenacao === 'quantidade') {
                    produtosArray.sort((a, b) => b.quantidade - a.quantidade);
                } else {
                    produtosArray.sort((a, b) => b.faturamento - a.faturamento);
                }
                
                // Calcular faturamento total
                const faturamentoTotal = produtosArray.reduce((total, p) => total + p.faturamento, 0);
                
                // Calcular percentual de cada produto
                produtosArray.forEach(p => {
                    p.percentual = (p.faturamento / faturamentoTotal) * 100;
                });
                
                // Guardar relatório
                relatorioProdutos = {
                    filtros: filtros,
                    faturamentoTotal: faturamentoTotal,
                    produtos: produtosArray
                };
                
                // Atualizar gráficos
                atualizarGraficosProdutos();
                
                // Atualizar tabela
                atualizarTabelaProdutos();
                
                // Exibir mensagem
                exibirMensagem('Relatório de produtos gerado com sucesso!', 'success');
            }
            
            function atualizarGraficosProdutos() {
                // Obter produtos ordenados
                const produtos = [...relatorioProdutos.produtos];
                
                // Limitar a 10 produtos para os gráficos
                const top10 = produtos.slice(0, 10);
                
                // Dados para gráfico de quantidade
                const labelsQuantidade = top10.map(p => p.nome);
                const dadosQuantidade = top10.map(p => p.quantidade);
                
                // Dados para gráfico de faturamento
                const labelsFaturamento = top10.map(p => p.nome);
                const dadosFaturamento = top10.map(p => p.faturamento);
                
                // Cores para os gráficos
                const cores = [
                    'rgba(11, 61, 145, 0.6)',
                    'rgba(255, 125, 0, 0.6)',
                    'rgba(67, 160, 71, 0.6)',
                    'rgba(255, 179, 0, 0.6)',
                    'rgba(229, 57, 53, 0.6)',
                    'rgba(3, 155, 229, 0.6)',
                    'rgba(156, 39, 176, 0.6)',
                    'rgba(255, 87, 34, 0.6)',
                    'rgba(0, 150, 136, 0.6)',
                    'rgba(96, 125, 139, 0.6)'
                ];
                
                // Atualizar gráfico de quantidade
                const ctxQuantidade = document.getElementById('chart-produtos-quantidade').getContext('2d');
                
                if (chartProdutosQuantidade) {
                    chartProdutosQuantidade.data.labels = labelsQuantidade;
                    chartProdutosQuantidade.data.datasets[0].data = dadosQuantidade;
                    chartProdutosQuantidade.update();
                } else {
                    chartProdutosQuantidade = new Chart(ctxQuantidade, {
                        type: 'bar',
                        data: {
                            labels: labelsQuantidade,
                            datasets: [{
                                label: 'Quantidade Vendida',
                                data: dadosQuantidade,
                                backgroundColor: cores,
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }
                
                // Atualizar gráfico de faturamento
                const ctxFaturamento = document.getElementById('chart-produtos-faturamento').getContext('2d');
                
                if (chartProdutosFaturamento) {
                    chartProdutosFaturamento.data.labels = labelsFaturamento;
                    chartProdutosFaturamento.data.datasets[0].data = dadosFaturamento;
                    chartProdutosFaturamento.update();
                } else {
                    chartProdutosFaturamento = new Chart(ctxFaturamento, {
                        type: 'bar',
                        data: {
                            labels: labelsFaturamento,
                            datasets: [{
                                label: 'Faturamento (R$)',
                                data: dadosFaturamento,
                                backgroundColor: cores,
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return 'R$ ' + value.toFixed(2);
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }
            
            function atualizarTabelaProdutos() {
                // Obter produtos do relatório
                const produtos = relatorioProdutos.produtos;
                
                // Limpar tabela
                const tbody = tabelaProdutos.querySelector('tbody');
                
                if (produtos.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center text-muted py-3">
                                <i class="fas fa-info-circle fa-2x mb-3"></i>
                                <p>Nenhum produto encontrado para os filtros selecionados</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                // Gerar linhas da tabela
                let html = '';
                
                produtos.forEach(produto => {
                    html += `
                        <tr>
                            <td>${produto.codigo || '-'}</td>
                            <td>${produto.nome}</td>
                            <td>${produto.grupo || '-'}</td>
                            <td>R$ ${produto.preco.toFixed(2)}</td>
                            <td>${produto.quantidade}</td>
                            <td>R$ ${produto.faturamento.toFixed(2)}</td>
                            <td>${produto.percentual.toFixed(2)}%</td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            }
            
            function gerarRelatorioClientes() {
                // Obter filtros
                const filtros = {
                    dataInicio: dataInicioClientesInput.value,
                    dataFim: dataFimClientesInput.value,
                    cidade: cidadeClienteSelect.value,
                    ordenacao: ordenacaoClienteSelect.value
                };
                
                // Obter vendas filtradas por data
                const vendas = db.getVendas().filter(venda => {
                    const dataVenda = new Date(venda.data);
                    const dataInicio = new Date(filtros.dataInicio);
                    const dataFim = new Date(filtros.dataFim);
                    
                    dataInicio.setHours(0, 0, 0, 0);
                    dataFim.setHours(23, 59, 59, 999);
                    
                    return dataVenda >= dataInicio && dataVenda <= dataFim;
                });
                
                // Obter clientes
                const clientes = db.getClientes();
                
                // Mapear clientes e suas compras
                const clientesCompras = {};
                
                vendas.forEach(venda => {
                    if (!clientesCompras[venda.cliente_id]) {
                        // Obter dados do cliente
                        const cliente = clientes.find(c => c.id === venda.cliente_id);
                        
                        // Se não encontrar o cliente ou não corresponder ao filtro de cidade, ignorar
                        if (!cliente || (filtros.cidade && cliente.cidade !== filtros.cidade)) {
                            return;
                        }
                        
                        clientesCompras[venda.cliente_id] = {
                            id: cliente.id,
                            nome: cliente.nome,
                            documento: cliente.documento || '',
                            cidade: cliente.cidade || '',
                            compras: [],
                            totalCompras: 0,
                            faturamento: 0,
                            ticketMedio: 0,
                            ultimaCompra: null
                        };
                    }
                    
                    // Adicionar compra
                    clientesCompras[venda.cliente_id].compras.push(venda);
                    clientesCompras[venda.cliente_id].totalCompras++;
                    clientesCompras[venda.cliente_id].faturamento += venda.total;
                    
                    // Atualizar última compra
                    const dataVenda = new Date(venda.data);
                    if (!clientesCompras[venda.cliente_id].ultimaCompra || 
                        dataVenda > new Date(clientesCompras[venda.cliente_id].ultimaCompra)) {
                        clientesCompras[venda.cliente_id].ultimaCompra = venda.data;
                    }
                });
                
                // Calcular ticket médio
                Object.values(clientesCompras).forEach(cliente => {
                    cliente.ticketMedio = cliente.totalCompras > 0 ? 
                        cliente.faturamento / cliente.totalCompras : 0;
                });
                
                // Converter para array
                const clientesArray = Object.values(clientesCompras);
                
                // Ordenar conforme selecionado
                if (filtros.ordenacao === 'frequencia') {
                    clientesArray.sort((a, b) => b.totalCompras - a.totalCompras);
                } else {
                    clientesArray.sort((a, b) => b.faturamento - a.faturamento);
                }
                
                // Calcular faturamento total
                const faturamentoTotal = clientesArray.reduce((total, c) => total + c.faturamento, 0);
                
                // Calcular percentual de cada cliente
                clientesArray.forEach(c => {
                    c.percentual = (c.faturamento / faturamentoTotal) * 100;
                });
                
                // Guardar relatório
                relatorioClientes = {
                    filtros: filtros,
                    faturamentoTotal: faturamentoTotal,
                    clientes: clientesArray
                };
                
                // Atualizar gráficos
                atualizarGraficosClientes();
                
                // Atualizar tabela
                atualizarTabelaClientes();
                
                // Exibir mensagem
                exibirMensagem('Relatório de clientes gerado com sucesso!', 'success');
            }
            
            function atualizarGraficosClientes() {
                // Obter clientes ordenados
                const clientes = [...relatorioClientes.clientes];
                
                // Limitar a 10 clientes para os gráficos
                const top10 = clientes.slice(0, 10);
                
                // Dados para gráfico de frequência
                const labelsFrequencia = top10.map(c => c.nome);
                const dadosFrequencia = top10.map(c => c.totalCompras);
                
                // Dados para gráfico de faturamento
                const labelsFaturamento = top10.map(c => c.nome);
                const dadosFaturamento = top10.map(c => c.faturamento);
                
                // Cores para os gráficos
                const cores = [
                    'rgba(11, 61, 145, 0.6)',
                    'rgba(255, 125, 0, 0.6)',
                    'rgba(67, 160, 71, 0.6)',
                    'rgba(255, 179, 0, 0.6)',
                    'rgba(229, 57, 53, 0.6)',
                    'rgba(3, 155, 229, 0.6)',
                    'rgba(156, 39, 176, 0.6)',
                    'rgba(255, 87, 34, 0.6)',
                    'rgba(0, 150, 136, 0.6)',
                    'rgba(96, 125, 139, 0.6)'
                ];
                
                // Atualizar gráfico de frequência
                const ctxFrequencia = document.getElementById('chart-clientes-frequencia').getContext('2d');
                
                if (chartClientesFrequencia) {
                    chartClientesFrequencia.data.labels = labelsFrequencia;
                    chartClientesFrequencia.data.datasets[0].data = dadosFrequencia;
                    chartClientesFrequencia.update();
                } else {
                    chartClientesFrequencia = new Chart(ctxFrequencia, {
                        type: 'bar',
                        data: {
                            labels: labelsFrequencia,
                            datasets: [{
                                label: 'Quantidade de Compras',
                                data: dadosFrequencia,
                                backgroundColor: cores,
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }
                
                // Atualizar gráfico de faturamento
                const ctxFaturamento =                                 <div class="form-group">
                                    <label for="forma-pagamento" class="form-label">Forma de Pagamento</label>
                                    <select id="forma-pagamento" class="form-control">
                                        <option value="">Todas</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-between mt-3">
                                <button id="btn-limpar-filtros" class="btn btn-outline-primary">
                                    <i class="fas fa-eraser"></i> Limpar Filtros
                                </button>
                                <button id="btn-gerar-relatorio" class="btn btn-primary">
                                    <i class="fas fa-chart-bar"></i> Gerar Relatório
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Resumo -->
                    <div class="dashboard-stats mb-4">
                        <div class="stat-card">
                            <div class="stat-icon sales">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-value" id="total-vendas">0</div>
                                <div class="stat-label">Vendas</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon revenue">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-value" id="total-faturamento">R$ 0,00</div>
                                <div class="stat-label">Faturamento</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon products">
                                <i class="fas fa-tags"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-value" id="ticket-medio">R$ 0,00</div>
                                <div class="stat-label">Ticket Médio</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon customers">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-value" id="total-descontos">R$ 0,00</div>
                                <div class="stat-label">Descontos</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gráficos -->
                    <div class="row" style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Vendas por Período</div>
                            </div>
                            <div class="card-body">
                                <canvas id="chart-vendas" width="400" height="200"></canvas>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Vendas por Forma de Pagamento</div>
                            </div>
                            <div class="card-body">
                                <canvas id="chart-pagamentos" width="200" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabela de Vendas -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Detalhamento de Vendas</div>
                            <div>
                                <button id="btn-exportar-vendas" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-file-export"></i> Exportar
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table" id="tabela-vendas">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Data</th>
                                            <th>Cliente</th>
                                            <th>Itens</th>
                                            <th>Forma de Pagamento</th>
                                            <th>Subtotal</th>
                                            <th>Desconto</th>
                                            <th>Total</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="9" class="text-center text-muted py-3">
                                                <p>Utilize os filtros acima para gerar o relatório</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Conteúdo da aba Produtos -->
                <div id="content-produtos" class="tab-content">
                    <!-- Filtros -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <div class="card-title">Filtros</div>
                        </div>
                        <div class="card-body">
                            <div class="row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div class="form-group">
                                    <label for="data-inicio-produtos" class="form-label">Data Inicial</label>
                                    <input type="date" id="data-inicio-produtos" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="data-fim-produtos" class="form-label">Data Final</label>
                                    <input type="date" id="data-fim-produtos" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="grupo-produto" class="form-label">Grupo</label>
                                    <select id="grupo-produto" class="form-control">
                                        <option value="">Todos</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="ordenacao-produto" class="form-label">Ordenar por</label>
                                    <select id="ordenacao-produto" class="form-control">
                                        <option value="quantidade">Quantidade Vendida</option>
                                        <option value="faturamento">Faturamento</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-between mt-3">
                                <button id="btn-limpar-filtros-produtos" class="btn btn-outline-primary">
                                    <i class="fas fa-eraser"></i> Limpar Filtros
                                </button>
                                <button id="btn-gerar-relatorio-produtos" class="btn btn-primary">
                                    <i class="fas fa-chart-bar"></i> Gerar Relatório
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gráficos -->
                    <div class="row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Top 10 Produtos - Quantidade</div>
                            </div>
                            <div class="card-body">
                                <canvas id="chart-produtos-quantidade" width="300" height="300"></canvas>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Top 10 Produtos - Faturamento</div>
                            </div>
                            <div class="card-body">
                                <canvas id="chart-produtos-faturamento" width="300" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabela de Produtos -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Detalhamento de Produtos</div>
                            <div>
                                <button id="btn-exportar-produtos" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-file-export"></i> Exportar
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table" id="tabela-produtos">
                                    <thead>
                                        <tr>
                                            <th>Código</th>
                                            <th>Produto</th>
                                            <th>Grupo</th>
                                            <th>Preço</th>
                                            <th>Quantidade Vendida</th>
                                            <th>Faturamento</th>
                                            <th>% do Faturamento</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="7" class="text-center text-muted py-3">
                                                <p>Utilize os filtros acima para gerar o relatório</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Conteúdo da aba Clientes -->
                <div id="content-clientes" class="tab-content">
                    <!-- Filtros -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <div class="card-title">Filtros</div>
                        </div>
                        <div class="card-body">
                            <div class="row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div class="form-group">
                                    <label for="data-inicio-clientes" class="form-label">Data Inicial</label>
                                    <input type="date" id="data-inicio-clientes" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="data-fim-clientes" class="form-label">Data Final</label>
                                    <input type="date" id="data-fim-clientes" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="cidade-cliente" class="form-label">Cidade</label>
                                    <select id="cidade-cliente" class="form-control">
                                        <option value="">Todas</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="ordenacao-cliente" class="form-label">Ordenar por</label>
                                    <select id="ordenacao-cliente" class="form-control">
                                        <option value="frequencia">Frequência de Compras</option>
                                        <option value="faturamento">Faturamento</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-between mt-3">
                                <button id="btn-limpar-filtros-clientes" class="btn btn-outline-primary">
                                    <i class="fas fa-eraser"></i> Limpar Filtros
                                </button>
                                <button id="btn-gerar-relatorio-clientes" class="btn btn-primary">
                                    <i class="fas fa-chart-bar"></i> Gerar Relatório
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gráficos -->
                    <div class="row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Top 10 Clientes - Frequência</div>
                            </div>
                            <div class="card-body">
                                <canvas id="chart-clientes-frequencia" width="300" height="300"></canvas>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Top 10 Clientes - Faturamento</div>
                            </div>
                            <div class="card-body">
                                <canvas id="chart-clientes-faturamento" width="300" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabela de Clientes -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Detalhamento de Clientes</div>
                            <div>
                                <button id="btn-exportar-clientes" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-file-export"></i> Exportar
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table" id="tabela-clientes">
                                    <thead>
                                        <tr>
                                            <th>Cliente</th>
                                            <th>Documento</th>
                                            <th>Cidade</th>
                                            <th>Compras</th>
                                            <th>Última Compra</th>
                                            <th>Faturamento</th>
                                            <th>Ticket Médio</th>
                                            <th>% do Faturamento</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="8" class="text-center text-muted py-3">
                                                <p>Utilize os filtros acima para gerar o relatório</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notificações -->
    <div class="toast-container" id="toast-container"></div>
    
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="assets/js/database.js"></script>
    <script src="assets/js/db-fix.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/core.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar autenticação
            if (!auth.verificarAutenticacao()) {
                window.location.href = 'index.html';
                return;
            }
            
            // Dados do usuário
            const user = auth.getUsuarioAtual();
            document.getElementById('user-name').textContent = user.nome;
            document.getElementById('user-role').textContent = user.perfil === 'admin' ? 'Administrador' : user.perfil === 'supervisor' ? 'Supervisor' : 'Vendedor';
            
            // Data atual
            const dataAtual = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = dataAtual.toLocaleDateString('pt-BR', options);
            
            // Elementos DOM - Tabs
            const tabVendas = document.getElementById('tab-vendas');
            const tabProdutos = document.getElementById('tab-produtos');
            const tabClientes = document.getElementById('tab-clientes');
            
            const contentVendas = document.getElementById('content-vendas');
            const contentProdutos = document.getElementById('content-produtos');
            const contentClientes = document.getElementById('content-clientes');
            
            // Elementos DOM - Filtros Vendas
            const dataInicioInput = document.getElementById('data-inicio');
            const dataFimInput = document.getElementById('data-fim');
            const clienteSelect = document.getElementById('cliente');
            const formaPagamentoSelect = document.getElementById('forma-pagamento');
            const btnLimparFiltros = document.getElementById('btn-limpar-filtros');
            const btnGerarRelatorio = document.getElementById('btn-gerar-relatorio');
            
            // Elementos DOM - Filtros Produtos
            const dataInicioProdutosInput = document.getElementById('data-inicio-produtos');
            const dataFimProdutosInput = document.getElementById('data-fim-produtos');
            const grupoProdutoSelect = document.getElementById('grupo-produto');
            const ordenacaoProdutoSelect = document.getElementById('ordenacao-produto');
            const btnLimparFiltrosProdutos = document.getElementById('btn-limpar-filtros-produtos');
            const btnGerarRelatorioProdutos = document.getElementById('btn-gerar-relatorio-produtos');
            
            // Elementos DOM - Filtros Clientes
            const dataInicioClientesInput = document.getElementById('data-inicio-clientes');
            const dataFimClientesInput = document.getElementById('data-fim-clientes');
            const cidadeClienteSelect = document.getElementById('cidade-cliente');
            const ordenacaoClienteSelect = document.getElementById('ordenacao-cliente');
            const btnLimparFiltrosClientes = document.getElementById('btn-limpar-filtros-clientes');
            const btnGerarRelatorioClientes = document.getElementById('btn-gerar-relatorio-clientes');
            
            // Elementos DOM - Exportação
            const btnExportarVendas = document.getElementById('btn-exportar-vendas');
            const btnExportarProdutos = document.getElementById('btn-exportar-produtos');
            const btnExportarClientes = document.getElementById('btn-exportar-clientes');
            
            // Tabelas
            const tabelaVendas = document.getElementById('tabela-vendas');
            const tabelaProdutos = document.getElementById('tabela-produtos');
            const tabelaClientes = document.getElementById('tabela-clientes');
            
            // Gráficos
            let chartVendas = null;
            let chartPagamentos = null;
            let chartProdutosQuantidade = null;
            let chartProdutosFaturamento = null;
            let chartClientesFrequencia = null;
            let chartClientesFaturamento = null;
            
            // Dados dos relatórios
            let relatorioVendas = null;
            let relatorioProdutos = null;
            let relatorioClientes = null;
            
            // Inicialização
            inicializarDatas();
            carregarClientes();
            carregarFormasPagamento();
            carregarGruposProdutos();
            carregarCidadesClientes();
            
            // Event Listeners - Tabs
            tabVendas.addEventListener('click', function() {
                ativarAba('vendas');
            });
            
            tabProdutos.addEventListener('click', function() {
                ativarAba('produtos');
            });
            
            tabClientes.addEventListener('click', function() {
                ativarAba('clientes');
            });
            
            // Event Listeners - Relatórios
            btnGerarRelatorio.addEventListener('click', gerarRelatorioVendas);
            btnGerarRelatorioProdutos.addEventListener('click', gerarRelatorioProdutos);
            btnGerarRelatorioClientes.addEventListener('click', gerarRelatorioClientes);
            
            // Event Listeners - Limpar Filtros
            btnLimparFiltros.addEventListener('click', function() {
                inicializarDatas();
                clienteSelect.value = '';
                formaPagamentoSelect.value = '';
            });
            
            btnLimparFiltrosProdutos.addEventListener('click', function() {
                inicializarDatasProdutos();
                grupoProdutoSelect.value = '';
                ordenacaoProdutoSelect.value = 'quantidade';
            });
            
            btnLimparFiltrosClientes.addEventListener('click', function() {
                inicializarDatasClientes();
                cidadeClienteSelect.value = '';
                ordenacaoClienteSelect.value = 'frequencia';
            });
            
            // Event Listeners - Exportação
            btnExportarVendas.addEventListener('click', exportarVendas);
            btnExportarProdutos.addEventListener('click', exportarProdutos);
            btnExportarClientes.addEventListener('click', exportarClientes);
            
            // Logout
            document.getElementById('btn-logout').addEventListener('click', function() {
                auth.fazerLogout();
                window.location.href = 'index.html';
            });
            
            // ========== FUNÇÕES ==========<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORION PDV - Relatórios</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono&display=swap">
    <link rel="stylesheet" href="assets/css/orion-theme.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="icon" href="assets/img/favicon.ico" type="image/x-icon">
</head>
<body>
    <!-- Container Principal -->
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="assets/img/logo-small.png" alt="ORION PDV">
                    <span>ORION PDV</span>
                </div>
                <button id="sidebar-collapse" class="sidebar-toggle d-none d-md-block">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="sidebar-menu">
                <a href="dashboard.html" class="menu-item">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="venda.html" class="menu-item">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Vendas PDV</span>
                </a>
                <a href="produto.html" class="menu-item">
                    <i class="fas fa-box"></i>
                    <span>Produtos</span>
                </a>
                <a href="estoque.html" class="menu-item">
                    <i class="fas fa-warehouse"></i>
                    <span>Estoque</span>
                </a>
                <a href="cliente.html" class="menu-item">
                    <i class="fas fa-users"></i>
                    <span>Clientes</span>
                </a>
                <a href="relatorio.html" class="menu-item active">
                    <i class="fas fa-chart-bar"></i>
                    <span>Relatórios</span>
                </a>
                <a href="config.html" class="menu-item">
                    <i class="fas fa-cog"></i>
                    <span>Configurações</span>
                </a>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-menu" id="user-menu">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-info">
                        <div class="user-name" id="user-name">Carregando...</div>
                        <div class="user-role" id="user-role">Carregando...</div>
                    </div>
                </div>
                <button id="btn-logout" class="sidebar-toggle">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
        
        <!-- Conteúdo Principal -->
        <div class="main-content">
            <div class="topbar">
                <div class="topbar-title">
                    <h1>Relatórios</h1>
                </div>
                <div class="topbar-actions">
                    <div id="current-date" class="d-none d-md-block">Carregando data...</div>
                </div>
            </div>
            
            <div class="page-content">
                <!-- Tabs -->
                <div class="tabs">
                    <div id="tab-vendas" class="tab active">Vendas</div>
                    <div id="tab-produtos" class="tab">Produtos</div>
                    <div id="tab-clientes" class="tab">Clientes</div>
                </div>
                
                <!-- Conteúdo da aba Vendas -->
                <div id="content-vendas" class="tab-content active">
                    <!-- Filtros -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <div class="card-title">Filtros</div>
                        </div>
                        <div class="card-body">
                            <div class="row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div class="form-group">
                                    <label for="data-inicio" class="form-label">Data Inicial</label>
                                    <input type="date" id="data-inicio" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="data-fim" class="form-label">Data Final</label>
                                    <input type="date" id="data-fim" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="cliente" class="form-label">Cliente</label>
                                    <select id="cliente" class="form-control">
                                        <option value="">Todos</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="forma-pagamento" class="form-label">Forma de Pagamento</label>
